{% comment %}
Warning: DO NOT EDIT THIS FILE!
Editing this file could break Cross Sell app functionality
version: xsell-v.2.0.0 [Do not remove version info]
support webite: http://help.csell.co
{% endcomment %}

{% comment %}
This snippet requires the addition of two css files to ASSETS folder of theme:
- xs-slick-theme.css
- xs-slick.css

This snippet requires the addition of the following line of code before end of
</body> tag in the theme's main theme.liquid file:

<script src="{{ 'https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js'}}" defer="defer"></script>

Failing to add above will break the slider/carousel and possibly cause responsive problems

{% endcomment %}

{% if template contains 'product' %}
  	{% assign cscurrentpage = 'product' %}
{% endif %}
{% if template == 'cart' %}
  	{% assign cscurrentpage = 'cart' %}
	{% assign cssmartcart = 'on' %}
{% endif %}

{% assign cartitems = ''%}
{% for item in cart.items %}
	{% if forloop.first == true %}
		{% capture cartitems %}{{ item.product.handle }}{% endcapture %}
	{% else %}
		{% capture cartitems %}{{ cartitems }},{{ item.product.handle }}{% endcapture %}
	{% endif %}
{% endfor %}

{% if shop.metafields.shopCrosssell.settings != null %}
<script>
  function slickCarouselLoad(){
  $('.cross-sell').slick({
  arrows: true,
  dots: false,
  infinite: false,
  speed: 300,
  autoplay:false,
  slidesToShow: 3,
  slidesToScroll: 1,
  responsive: [
    {
      breakpoint: 1024,
      settings: {
        slidesToShow: 3,
        slidesToScroll: 1,
        infinite: true,
        dots: false
      }
    },
    {
      breakpoint: 600,
      settings: {
        slidesToShow: 2,
        slidesToScroll: 2

      }
    },
    {
      breakpoint: 480,
      settings: {
        slidesToShow: 1,
        slidesToScroll: 1


      }
    }
    // You can unslick at a given breakpoint now by adding:
    // settings: "unslick"
    // instead of a settings object
  ]
  });
  }
</script>
<style type="text/css">
  /*
  #cross-sell{float:left;clear:both;width:100%;}
  h3.crossselltitle{margin:25px 0;text-align: center;}
  .cross-sell{overflow:hidden;list-style-type:none;margin:0;padding:0;clear:both;text-align:center;}
  .cross-sell *{font-size:13px; text-align:center; padding:0;}
  .cross-sell h4{border:none;margin:5px 0 0 0;line-height:1.5;}
  .cross-sell div.image{height:180px;}
  .cross-sell li{float: none;display:inline-block;vertical-align: text-top;padding:0 0 10px 0;margin:0 14px 30px 0;position:relative;width:172px;}
  .cross-sell li:last-child{margin-right:0;}
  .cross-sell li .image{}
  .cross-sell li .image img{margin:0px 0 10px 0px;float:left;width:100%;}
  .cross-sell li .producttitle{float:left;padding:5px 0;width:100%;min-height:56px;}
  .cross-sell li a{text-decoration:none;font-size:115%;line-height:20px;padding:5px;}
  .cross-sell li .money a{font-size:180%;float:left;text-align:center; padding:5px 0;width:100%;}
  .cross-sell .xs-compare-at-price{padding-right: 5px;display: inline-block;text-decoration: line-through;}
  .cross-sell .xs-vendor-name{padding:5px 0;width:100%;display:inline-block;}
  .cs-clearfix:after {content: "."; visibility: hidden; display: block; height: 0; clear: both;}
  */
  #cross-sell .related-products--grid {font-size: inherit!important;}
  #cross-sell .columns{margin:10px;}
  #cross-sell .slick-prev {top:45%;}
  #cross-sell .slick-next{top:45%;right:-25px}

</style>
{{ 'xs-slick.css' | asset_url | stylesheet_tag }}
{{ 'xs-slick-theme.css' | asset_url | stylesheet_tag }}

<div class="cs-clearfix"></div>
<div id="cross-sell"></div>
<div class="cs-clearfix"></div>

<script type="text/javascript" charset="utf-8">

  var xsellSettings = xsellSettings || {};
{% if cartitems %}
    var cartitems = '{{ cartitems }}';
	xsellSettings.cartitems = cartitems.split(',');
{% else %}
	xsellSettings.cartitems = [];
{% endif %}

    xsellSettings.shopMetafields = eval({{ shop.metafields.shopCrosssell | json }});
    xsellSettings.crosssellsettings = eval({{ shop.metafields.shopCrosssell.settings | json }});
    xsellSettings.money_format = '{{shop.money_format}}';
    xsellSettings.xsmainproducthandle = '{{ product.handle }}';
    xsellSettings.currentpagetype = '{{ cscurrentpage }}';
    xsellSettings.xsimagesize = 'large';

  	xsellSettings.xsrandomizeproductpage = xsellSettings.crosssellsettings[0]['randomizeproductpage'];
  	xsellSettings.xsrandomizecartpage = xsellSettings.crosssellsettings[0]['randomizecartpage'];
  	xsellSettings.xsmustbeavailable = xsellSettings.crosssellsettings[0]['mustbeavailable'];
  	xsellSettings.xshideifincart = xsellSettings.crosssellsettings[0]['hideifincart'];

  	xsellSettings.xsdisplaycompareatprice = xsellSettings.crosssellsettings[0]['displaycompareatprice'];
  	xsellSettings.xsdisplaysalebadge = xsellSettings.crosssellsettings[0]['displaysalebadge'];
  	xsellSettings.xsdisplaypricevarieslabel = xsellSettings.crosssellsettings[0]['displaypricevarieslabel'];
  	xsellSettings.xsdisplayvendor = xsellSettings.crosssellsettings[0]['displayvendor'];


  {% if cscurrentpage == 'product' %}
    //product specific settings
    var crossselltitleproductpage = xsellSettings.crosssellsettings[0]['titleproductpage'];
    var crossselltitleproductpagedefault = xsellSettings.crosssellsettings[0]['titleproductpagedefault'];
    var crosssellshowdefault = xsellSettings.crosssellsettings[0]['showdefault'];

    xsellSettings.crosssellmaxitems = xsellSettings.crosssellsettings[0]['productpagemaxitems'];
  {% else if cscurrentpage == 'cart' %}
    //cart/basket settings
    var crossselltitlecheckoutpage = xsellSettings.crosssellsettings[0]['titlecheckoutpage'];
    var crosssellshowcheckout = xsellSettings.crosssellsettings[0]['showcheckout'];

    xsellSettings.crosssellmaxitems = xsellSettings.crosssellsettings[0]['checkoutpagemaxitems'];
  {% endif %}


</script>

{% endif %}

<script type="text/javascript" charset="utf-8">
var xsproductsData = '';
xsellSettings.xstitle = "";

var xsappinitfrontend = function(){
  {% if cscurrentpage == 'product' %}
    //First of all, see if this product has any handpicked crosssell items
    if(crosssellshowdefault != '4'){
      {% if product.metafields.productDetails.crosssell != null %}
      //See if the selected product has any cross-sell items
      xsproductsData = eval({{ product.metafields.productDetails.crosssell | json }});
      if(crossselltitleproductpage.length){
        xsellSettings.xstitle = crossselltitleproductpage;
      }
      {% endif %}
    }
    if(crosssellshowdefault == '1' || (crosssellshowdefault == '2' && xsproductsData == '')){
      //Show default cross-sell items on all product pages? Override all
      //See if any default cross-sell items have been selected for the product page
      {% if shop.metafields.shopCrosssell.default != null %}
      xsproductsData = eval({{ shop.metafields.shopCrosssell.default | json }});
      if(crossselltitleproductpagedefault.length){
        xsellSettings.xstitle = crossselltitleproductpagedefault;
      }
      {% endif %}
    }
  {% else %}

    if(crosssellshowcheckout == '2'){
      {% if shop.metafields.shopCrosssell.settings != null %}
      {% assign crosssellsettings = shop.metafields.shopCrosssell.settings | remove: "[{" | remove: "}]" | strip | replace: '","', '"|||"' | split: '|||' %}
      {% for settingpair in crosssellsettings %}
      {% assign setting = settingpair    | strip | split: ' : ' %}
      {% capture main %}{{ setting[0] | replace: '"', '' }}{% endcapture %}
      {% case main %}
      {% when 'cssmartcart' %}
      {% capture cssmartcart %}{{ setting[1] | replace: '"', '' }}{% endcapture %}
      {% endcase %}
      {% endfor %}
      {% endif %}

      {% if cssmartcart == 'on' %}
      {% for item in cart.items %}
      {% assign csitem = all_products[item.product.handle] %}
      {% if csitem.metafields.productDetails.crosssell != null %}
      {% assign csitemmetafield = csitem.metafields.productDetails.crosssell %}
      {% capture cssmartcartxsells %}{{ csitemmetafield }}{% endcapture %}
      {% break %}
      {% endif %}
      {% endfor %}
      {% endif %}

      {% comment %}Grab default Cart Cross-Sells if set{% endcomment %}
      {% if shop.metafields.shopCrosssell.checkout != null %}
      	{% assign csdefaultcartxsells = shop.metafields.shopCrosssell.checkout %}
      {% endif %}

      {% if cssmartcart == 'on' and cssmartcartxsells != null %}
      	{% assign _xsproductsData = cssmartcartxsells %}
      {% else %}
      	{% assign _xsproductsData = csdefaultcartxsells %}
      {% endif %}

      xsproductsData = eval({{ _xsproductsData | json }});

      if(crossselltitlecheckoutpage.length){
        xsellSettings.xstitle = crossselltitlecheckoutpage;
      }

    }
  {% endif %}

  if(xsproductsData){
    //Set the maximum number of items that should be shown?
    if (xsproductsData.length && (xsproductsData[0] !== '')){
      whenAvailable('xsellLib')

    }else {
      //There are no cross-sells to display
      var elem = document.getElementById("cross-sell");
      elem.parentNode.removeChild(elem);
    }
  }
}


  function whenAvailable(name) {
      var interval = 100;
      window.setTimeout(function() {
          if (window[name]) {
              xsellLib.init(xsproductsData, xsellSettings);
      		    addThemeCustomization();
          } else {
              window.setTimeout(whenAvailable(name), interval);
          }
      }, interval);
  }

  // load jquery and init
  function xsloadScript(url, callback) {
    var script = document.createElement("script");
    script.type = "text/javascript";

    if (script.readyState) { // IE support
      script.onreadystatechange = function() {
        if (script.readyState == "loaded" || script.readyState == "complete") {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { // other browsers
      script.onload = function() {
        callback();
      };
    }
    script.src = url;
    document.getElementsByTagName("head")[0].appendChild(script);
  };


  if ((typeof jQueryxsApp === 'undefined') || (parseFloat(jQueryxsApp.fn.jquery) < 3)) {
    xsloadScript('//ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js', function() {
      jQueryxsApp = jQuery.noConflict(true);
      xsappinitfrontend();
    });
  } else {
    xsappinitfrontend();
  }
var addThemeCustomization = function(){
 xsellLib.customBuildxsellsoutput = function(xsellitems, numproducts){
     	// put output code here
      // START HERE
   // settings from GUI
  	var xsmustbeavailable = xsellSettings.xsmustbeavailable;
  	var xshideifincart = xsellSettings.xshideifincart;
  	var xsdisplaycompareatprice = xsellSettings.xsdisplaycompareatprice;
  	var xsdisplaysalebadge = xsellSettings.xsdisplaysalebadge;
  	var xsdisplaypricevarieslabel = xsellSettings.xsdisplaypricevarieslabel;
  	var xsdisplayvendor = xsellSettings.xsdisplayvendor;
    // START HERE
    var xsimagesize = 'large';
                var xsvendoroutput = '';
      			var xspricevarieslabel = '';
                var xscompareatprice = '';
                var xscompareatpricestring = '';
              	var xssalepricestring = '';
              	var xspriceoutput = '';
                var xssalebadge = '<span class="badge badge--sale"><span class="badge__text">SALE</span></span>';
              	var xssalebadgeoutput = '';
                var saleclass = ' xs-sale';
                var fromlabel = '<em>from</em>';
                var xsprice = '';
              	for(var x=0; x < numproducts; x++)
				{
                  	var xsproductdata = xsellitems[x];
                    // alpha omega cycle for Turbo theme START
                    var alphaomega = '';
                    var evenodd = '';
                    for (var j=0; j<xsproductdata.length; j++)
                    {
                      evenodd = (j % 2 == 0)? ' even' : ' odd';
                      if(j==0)
                      {
                        alphaomega = ' alpha ';
                      }
                      else if(j == (xsproductdata.length - 1))
                      {
                    alphaomega = ' omega ';
                      }
                      else
                      {
                        alphaomega = ' ';
                      }
                    }
                    // alpha omega cycle for Turbo theme END
                  	//Show Images
                    if(xsproductdata.images.length > 1)
                    {
                      var csimage = xsellLib.productimageurls(xsproductdata.images[0]);
                      var csimagetwo = xsellLib.productimageurls(xsproductdata.images[1]);
                    }
                    else if(xsproductdata.images.length == 1)
                    {
                      var csimage = xsellLib.productimageurls(xsproductdata.images[0]);
                      var csimagetwo = 'https://cdn.shopify.com/s/images/admin/no-image-'+xsimagesize+'.gif';
                    }
                    else
                    {
                      var csimage = 'https://cdn.shopify.com/s/images/admin/no-image-'+xsimagesize+'.gif';
                      var csimagetwo = csimage;
                    }

                  	//Display Vendor
                     if(xsdisplayvendor)
                     {
                       xsvendoroutput = '<div class="xs-vendor-name"><a href="' + xsproductdata.url +'">' + xsproductdata.vendor + '</a></div>';
                     }



                    //Build Price Output
                    xsprice = xsellLib.xsformatMoney(xsproductdata.price, '{{ shop.money_format }}');


					//Show price varies label?
                    if(xsdisplaypricevarieslabel)
                    {
                    	if(xsproductdata.price_varies)
                      	{
                          xspricevarieslabel = 'From: ';
                      	}
                      	else
                      	{
                        	xspricevarieslabel = '';
                      	}
                    }

                    xspriceoutput = '<div class="money"><a href="' + xsproductdata.url +'">' + xspricevarieslabel + xsprice + '</a></div>';

                    if(xsdisplaycompareatprice)
                    {
  	                  if(!xsproductdata.price_varies && (xsproductdata.compare_at_price > xsproductdata.price))
        	            {
            	            xscompareatprice = xsformatMoney(xsproductdata.compare_at_price, '{{ shop.money_format }}');
                          xscompareatpricestring = '<span class="xs-compare-at-price">' + xscompareatprice + '</span>';
                          xssalepricestring = '<span class="xs-sale-price"><a href="' + xsproductdata.url +'">' + xsprice + '</a></span>';
                          xspriceoutput = '<div class="money' + saleclass + '">' + xscompareatpricestring + ' ' + xspricevarieslabel + xssalepricestring + '</div>';
                      }
                    }

                    //Show Sale Badge Output
                    if(xsdisplaysalebadge)
                    {
                      if(xsproductdata.compare_at_price > xsproductdata.price)
                      {
                        xssalebadgeoutput = xssalebadge;
                      }
					  else
                      {
                        xssalebadgeoutput = '';
                      }
                    }

                    xsellLib.xselloutput += '<div class="one-third column '+ alphaomega + 'thumbnail' + evenodd + '" itemprop="itemListElement" itemscope="" itemtype="http://schema.org/Product">'
                      + '<div class="product-wrap">'
                        + '<div class="relative product_image swap-true">'
                          + '<a href="' + xsproductdata.url + '" itemprop="url">'
                            +'<div class="image__container" style="max-width: 400.0px; border-radius:30%">'
                            + '<img src="' + csimage + '" alt="' + xsproductdata.title + '" class="appear lazyautosizes lazyloaded" style="width: 100%; height: auto; max-width:1290px;" data-sizes="auto" data-src="' + csimage + '" />'
                                            +'</div>'
                    + '<img src="' + csimagetwo + '" alt="' + xsproductdata.title + '" class="secondary lazyloaded"  data-src="' + csimagetwo + '" />'
                          + '</a>'
                          + '<div class="thumbnail-overlay">'
                            + '<a href="' + xsproductdata.url + '" itemprop="url" class="hidden-product-link">' + xsproductdata.title + '</a>'
                            + '<div class="info">'

                          + '<div class="product-details">'
                          + '<a href="'+xsproductdata.url+'"><span class="title" itemprop="name">' + xsproductdata.title + '</span></a>'
                          //+ '<span class="shopify-product-reviews-badge" data-id="' + xsproductdata.id + '"></span>'
                          // + '<span itemprop="brand" class="brand">' + xsproductdata.vendor + '</span>'
                          + '<span class="price ' + saleclass + '" itemprop="offers" itemscope itemtype="http://schema.org/Offer">'
                            + '<span> ' + xspriceoutput + ' </span>'
                            + xscompareatpricestring
                          + '</span>'
                        + '</div>'

                            + '</div>'
                          + '</div>'
                          + '<div class="banner_holder">'
                            + xssalebadgeoutput
                          + '</div>'
                        + '</div>'
                        //+ '<a class="product-info__caption" href="' + xsproductdata.url + '" itemprop="url">'

                        //+ '</a>'
                      + '</div>'
                    //+'<div class="jdgm-widget jdgm-preview-badge" data-id='+xsproductdata.id+'>'+xsproductdata.metafields.judgeme.badge+'</div>'
                    + '</div>';
				}
				if(xsellLib.xselloutput != '')
				{
          jQueryxsApp('#cross-sell').append('<div class="container"><div class="related-products__title"><h4 class="title center">' + xsellLib.settings.xstitle + '</h4><div class="feature_divider"></div></div></div><div class="container related-products--grid"><div itemtype="http://schema.org/ItemList" class="product-list collection-matrix clearfix cross-sell">'+xsellLib.xselloutput+'</div></div>');
          setTimeout(function(){
               slickCarouselLoad();
      }, 500);
        }
     //end
    }
}

</script>
